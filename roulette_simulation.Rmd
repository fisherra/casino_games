---
title: "Roulette Simulation"
author: "Fisher Ankney"
date: "4/24/2018"
output: html_document
---

<br> 

### Introduction 

I recently watched the movie *Support your Local Gunfighter*, a classic western from 1971. Several times throughout the movie, the protagonist Latigo places his signature 23-black bet on a game of roulettete. While Latigo went all in on his lucky number, I began to dream up a simple roulette simulation in R.

I've devised a short study to evaluate three roulette strategies over a period of time in order to practice for-loop and if-then statements in R. In this simulation, Gambler A always bets $10 on black, which has a 47.37% chance of winning. Gambler B always bets \$10 on the third dozen numbers, which has a 32.43% chane of winning. Gambler C, Latigo, Always bets \$10 on 23 black, which has a 2.7% change of winning. 

By creating a sample of 10,000 roulette spins and running a simulation with these three gambling strategies, I will evaluate how each gambler performs at differing intervals. The number of wins and total earnings of each gambler, how these trends change over time, and the occurances and duration of *dry streaks* are all of interest in this simulation. 

I'll finish up the post by creating a simple roulette function in R that will satisfy all of your gambling desires. But I' be willing to bet that those desires will be long gone after we evaluate the long term earnings associated with playing roulette. 

<br> 

### Libraries 

The only library needed to complete this study is the tidyverse set of packages.
```{r, message=F}
library('tidyverse')
```

<br> 

### Simulation

I've created this script to simulate 10,000 roulette spins as a separate file. The script loads the tidyverse set of packages, then creates a data structure saving 10,000 elements containing a randomly chosen number between -1 and 36. Each of these element are individually chosen, and are not affected by the preceding sample. The data structure is saved as a .csv file and loaded into this study.

```{r, eval=F}
# A copy of the roulette.csv file

library('tidyverse')

roulette <- as_tibble(sample(-1:36, 10000, replace=T))
write_csv(roulette, "roulette.csv")
```

<br> 

```{r}
# loading roulette.csv
roulette <- read_csv("roulette.csv")
roulette <- as.integer(roulette$value)
str(roulette)
```

<br> 

I need to define the three gambling techniques before I can analyze them. Gambler A always bets on black, Gambler B always bets the third dozen, and Gambler C always bets on lucky number 23. 

```{r, warning=F}
# The Gamblers Bets
black <- c(2, 4, 7, 8, 10, 11, 13, 15, 17, 20, 22, 24, 26, 28, 29, 31, 33, 35)
third_dozen <- c(25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36)
lucky_23 <- 23
```

<br> 

The next step is to create a series of data structures to record how each gambler performs throughout the simulation. A vector to record cash is created for each of the three strategies. Cash records the cumulative earnings (or losings) for each of the 10,000 spins. At the end of every spin, a singular variable, *total cash* is saved for each of the three gamblers. Total cash is copied to an element of the cash vector, thus saving it's value for each of the 10,000 spins. 

A similiar process is used for keeping track of each gamblers wins. A wins vector is created continuously record the number of wins throughout the simulation. A single variable, total wins, is updated and copied to an element of the wins vector for each spin. 

This system is repeated three times in order to keep track of all three gamblers running winnings, cumulative winnings, running earnings, and cumulative earnings. 

```{r}
# Initialize gambler A
ga_earn <- vector("double", length(roulette))
ga_total_earn <- 0 
ga_wins <- vector("double", length(roulette))
ga_total_wins <- 0 

# Initialize gambler B
gb_earn <- vector("double", length(roulette))
gb_total_earn <- 0 
gb_wins <- vector("double", length(roulette))
gb_total_wins <- 0 

# Initialize gambler C
gc_earn <- vector("double", length(roulette))
gc_total_earn <- 0 
gc_wins <- vector("double", length(roulette))
gc_total_wins <- 0 
```

<br> 

Now to analyze the roulette spins. For each element in the sequence of 10,000 spins saved in the variable `roulette`, the following occurs. Ten dollars is taken from each of the gamblers total winnings as their bets. The new total winnings amount is saved over the old winnings. If the number inside of the roulette element falls within the previously defined `black` bet, gambler a wins. When gambler A wins, gambler A's total cash is increased by $20 and their total wins are increased by 1. Gamblers B and C go through similiar if - then statements, eaching recieving winnings according to the payout of their specific bets. After all of the gamblers bets have been analyzed, the new total earnings and wins are saved into an empty element in the running cash and wins matrices. 

The running wins and earnings matrices are the key to exploring each of the gamblings stragies in this simulation. 

```{r}

for (i in seq_along(roulette)) {
# All gamblers bet $10
  ga_total_earn = ga_total_earn - 10
  gb_total_earn = gb_total_earn - 10
  gc_total_earn = gc_total_earn - 10
# If gambler A wins, +$20 and +1 win
  if (roulette[[i]] %in% black) {
    ga_total_earn = ga_total_earn + 20 
    ga_total_wins = ga_total_wins + 1 
  }
# If gambler B wins, +$30 and +1 win
  if (roulette[[i]] %in% third_dozen) {
    gb_total_earn = gb_total_earn + 30 
    gb_total_wins = gb_total_wins + 1
  }
# If gambler C wins, +$360 and +1 win
  if (roulette[[i]] == lucky_23) {
    gc_total_earn = gc_total_earn + 360
    gc_total_wins = gc_total_wins + 1
  }
# End of round - save totals 
  ga_earn[[i]] <- ga_total_earn
  ga_wins[[i]] <- ga_total_wins
  gb_earn[[i]] <- gb_total_earn
  gb_wins[[i]] <- gb_total_wins
  gc_earn[[i]] <- gc_total_earn
  gc_wins[[i]] <- gc_total_wins
}
```

<br> 

### Evaluation 

Before we jump into the wins and cash matrices, I'm going to quickly plot up the 10,000 roulette spins to see if I can spot any unwanted patterns. The roulette spin results should all be random numbers between -1 and 36, independent of each other. 

```{r}
plot(roulette)
```

<br> 

There arn't any obvious patterns in this simple plot, so I'll take that as a sign that the random sample of roulette spins worked! Now we can dive into analyzing the results. I'm breaking number of spins we analyze into three chunks. First we'll look at trends within the first 100 spins, `results_100`, then we'll look at the first 1000 spins, `results_1000`, and finally all 10,000 spins, `results`. 

```{r}
ga <- "Gambler A"
gb <- "Gambler B"
gc <- "Gambler C"

results <- tibble(spin_num = 1:10000, ga, ga_earn, ga_wins, gb, gb_earn, gb_wins, gc, gc_earn, gc_wins)
results_100 <- head(results, n=100)
results_1000 <- head(results, n=1000)
```

<br> 

Let's take a look at how many times each of the gamblers won their roulette bet in the first 100 spins. 

```{r}
ggplot(results_100) + 
  geom_point(aes(x = spin_num, y = ga_wins, color = ga), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y = gb_wins, color = gb), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y  = gc_wins, color = gc), alpha = 0.8) + 
  theme_minimal() +
  theme(legend.title=element_blank()) + 
  scale_colour_manual(values = c("black", "#E0080B", "#016D29")) + 
    labs(title = "100 Spin Results - Wins", 
       y = "Number of Wins",
       x = "Number of Spins"
       )
```

<br> 

If it isn't clear by the graph, here's the each of the gambler's running totals at spin 100. 

```{r}
ga_wins[100]
gb_wins[100]
gc_wins[100]
```

<br> 

It turns out that 100 spins is a large enough sample size to accurately reflect the probability of each gambler's bets. Gambler A's probability of winning is ~47%, Gambler B's is ~32%, and Gambler C's is ~3%. Now let's have a look at each of the gamblers earnings in the first 100 roulette games. 

```{r}
ggplot(results_100) + 
  geom_point(aes(x = spin_num, y = ga_earn, color = ga), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y = gb_earn, color = gb), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y = gc_earn, color = gc), alpha = 0.8) + 
  theme_minimal() +
  theme(legend.title=element_blank()) + 
  scale_colour_manual(values = c("black", "#E0080B", "#016D29")) + 
    labs(title = "100 Spin Results - Earnings", 
       y = "Earnings ($)",
       x = "Number of Spins"
       )
```

<br>

No gambler earns money by the end of the first 100 simulated spins. Gambler C is the most interesting to observe because of the massive payout upon each win. Briefly, around spin 28, Gambler C reaches a maxima at $50. Increasing the sample size by a magnitude may tell us a different story.


```{r}
ggplot(results_1000) + 
  geom_point(aes(x = spin_num, y = ga_earn, color = ga), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y = gb_earn, color = gb), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y  = gc_earn, color = gc), alpha = 0.8) + 
  theme_minimal() +
  theme(legend.title=element_blank()) + 
  scale_colour_manual(values = c("black", "#E0080B", "#016D29")) + 
    labs(title = "1000 Spin Results - Earnings", 
       y = "Earnings ($)",
       x = "Number of Spins"
       )
```

<br>

Increasing the sample size by 900 tells us a very different story for Gambler C. Their luck takes a turn for the better, ending the 1000 spin simulation at over $1000 in earnings. Gambler A and Gambler B keep to much the same earnings path, steadily lossing money. 

```{r}
ga_earn[1000]
gb_earn[1000]
gc_earn[1000]
```

<br> 

Increasing the sample size by another magnitude tells us another story. 

```{r}
ggplot(results) + 
  geom_point(aes(x = spin_num, y = ga_earn, color = ga), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y = gb_earn, color = gb), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y  = gc_earn, color = gc), alpha = 0.8) + 
  theme_minimal() +
  theme(legend.title=element_blank()) + 
  scale_colour_manual(values = c("black", "#E0080B", "#016D29")) + 
    labs(title = "10,000 Spin Results - Earnings", 
       y = "Earnings ($)",
       x = "Number of Spins"
       )
```

<br> 


```{r}
ggplot(results) + 
  geom_point(aes(x = spin_num, y = ga_wins, color = ga), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y = gb_wins, color = gb), alpha = 0.8) + 
  geom_point(aes(x = spin_num, y  = gc_wins, color = gc), alpha = 0.8) + 
  theme_minimal() +
  theme(legend.title=element_blank()) + 
  scale_colour_manual(values = c("black", "#E0080B", "#016D29")) + 
    labs(title = "10,000 Spin Results - Wins", 
       y = "Number of Wins",
       x = "Number of Spins"
       )

```

<br>

trendline for 10,000, average lose per spin for each gambler, max / min, box plot for dry streak each player 

```{r}
ga_total_wins / 10000 * 100
gb_total_wins / 10000 * 100
gc_total_wins / 10000 * 100
```

<br> 

actual probability of each win - 
half bet = 46.37%
thirds bet = 31.58%
single number bet = 2.63%

Average loss - 
```{r}
ga_total_earn / 10000
gb_total_earn / 10000
gc_total_earn / 10000
```

<br> 

```{r}
min(ga_earn)
min(gb_earn)
min(gc_earn)

```

<br> 

```{r, error=T}
ga_wins_lead <- lead(ga_wins)
gb_wins_lead <- lead(gb_wins)
gc_wins_lead <- lead(gc_wins) 

ga_wins_binary <- ga_wins_lead - ga_wins
ga_wins_binary[10000] = 0
gb_wins_binary <- gb_wins_lead - gb_wins
gb_wins_binary[10000] = 0 
gc_wins_binary <- gc_wins_lead - gc_wins
gc_wins_binary[10000] = 0

dry_count_a <- 0 
dry_count_save_a  <- vector("double", length(ga_wins_binary))
dry_count_b <- 0
dry_count_save_b  <- vector("double", length(gb_wins_binary))
dry_count_c <- 0
dry_count_save_c  <- vector("double", length(gc_wins_binary))


 
for (i in seq_along(ga_wins_binary)) {
  if (ga_wins_binary[[i]] == FALSE) {
    dry_count_a = dry_count_a + 1
  }
  if (ga_wins_binary[[i]] == TRUE) {
    dry_count_save_a[[i]] = dry_count_a
    dry_count_a = 0
  }
}

dry_count_save_a
dry_tibble_a <- tibble("dry_streak" = dry_count_save_a)

ggplot(dry_tibble_a) + 
  geom_bar(aes(dry_streak))
  
for (i in seq_along(gb_wins_binary)) {
  if (gb_wins_binary[[i]] == FALSE) {
    dry_count_b = dry_count_b + 1
  }
  if (gb_wins_binary[[i]] == TRUE) {
    dry_count_save_b[[i]] = dry_count_b
    dry_count_b = 0
  } 
}

dry_count_save_b
dry_tibble_b <- tibble("dry_streak" = dry_count_save_b)

ggplot(dry_tibble_b) + 
  geom_bar(aes(dry_streak))

for (i in seq_along(gc_wins_binary)) {
  if (gc_wins_binary[[i]] == FALSE) {
    dry_count_c = dry_count_c + 1
  }
  if (gc_wins_binary[[i]] == TRUE) {
    dry_count_save_c[[i]] = dry_count_c
    dry_count_c = 0
  } 
}

dry_count_save_c
dry_tibble_c <- tibble("dry_streak" = dry_count_save_c)

ggplot(dry_tibble_c) + 
  geom_bar(aes(dry_streak))

```


create a roulette function

```{r, eval = F}
mini_roulette <- function(bet, num) {

  print(str_c("You've bet $", bet, " on ", num))
  result = sample(0:12,1)
  print(str_c("The ball has landed on ", result))
  
  if ( num == result ) {
    print(str_c("You've Won $", bet * 36, "!"))
    total_winnings = total_winnings + bet * 36
  } else {
    print ("You Lose!")
    total_winnings = total_winnings - bet
  }
  print(str_c("Your total winnings are ", total_winnings, " dollars"))
}

mini_roulette(100, 0)
mini_roulette(100, 1)
mini_roulette(100, 2)
```
